<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WAVETUNE</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
body {
    margin:0; font-family: Arial, sans-serif;
    display:flex; height:100vh;
    background: linear-gradient(135deg, #3d1e9e, #d1c96b);
    color:white;
}
.sidebar {
    width:250px; background: rgba(0,0,0,.35); padding:20px;
}
.sidebar h3 {text-align:center; margin-bottom:20px;}
.sidebar a {
    display:block; padding:10px; color:#ccc; text-decoration:none; margin-bottom:5px; border-radius:8px;
}
.sidebar a.active, .sidebar a:hover { background: rgba(255,255,255,.2); color:white;}
.main {flex:1; padding:20px; overflow-y:auto;}
.page {display:none;}
.page.active {display:block;}
.playlist-card {
    background: rgba(255,255,255,.15);
    padding:20px; border-radius:15px;
    cursor:pointer; text-align:center;
}
.list-group-item {
    background: transparent; color:white;
}
.form-control {background: rgba(255,255,255,.15); border:none; color:white;}
.form-control::placeholder {color: rgba(255,255,255,.7);}
button {margin-top:5px;}
img {display:block; margin:auto;}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h3>WAVETUNE</h3>
    <a class="nav-link active" data-page="home">Home</a>
    <a class="nav-link" data-page="playlist">Playlist</a>
    <a class="nav-link" data-page="addsongs">Add Songs</a>
    <a class="nav-link" data-page="nowplaying">Now Playing</a>
</div>

<!-- MAIN -->
<div class="main">

<!-- HOME PAGE -->
<section id="home" class="page active">
    <h3>Your Playlists</h3>
    <div class="row g-3">
        <div class="col-md-3"><div class="playlist-card" data-playlist="Chill Vibes">Chill Vibes</div></div>
        <div class="col-md-3"><div class="playlist-card" data-playlist="Workout Mix">Workout Mix</div></div>
        <div class="col-md-3"><div class="playlist-card" data-playlist="Road Trip">Road Trip</div></div>
    </div>
</section>

<!-- PLAYLIST PAGE -->
<section id="playlist" class="page">
    <h3 id="currentPlaylistTitle">Chill Vibes</h3>
    <button class="btn btn-success btn-sm" onclick="createPlaylist()">+ New Playlist</button>
    <button class="btn btn-warning btn-sm" onclick="renamePlaylist()">Rename</button>
    <button class="btn btn-danger btn-sm" onclick="deletePlaylist()">Delete</button>

    <input id="searchSong" class="form-control my-3" placeholder="Search songs...">
    <ul id="playlistSongs" class="list-group"></ul>
</section>

<!-- ADD SONGS PAGE -->
<section id="addsongs" class="page text-center">
    <h3>Add YouTube Song</h3>
    <select id="playlistSelect" class="form-select w-50 mx-auto mb-2"></select>
    <input id="ytLink" class="form-control w-50 mx-auto" placeholder="Paste YouTube link here">
    <button id="addSongBtn" class="btn btn-primary mt-3">Add Song</button>
</section>

<!-- NOW PLAYING PAGE -->
<section id="nowplaying" class="page text-center">
    <h3 class="song-title">No song playing</h3>
    <p class="song-artist"></p>
    <img id="songThumbnail" class="img-fluid rounded my-3" style="max-width:300px">
    <div class="ratio ratio-16x9 mx-auto" style="max-width:500px">
        <iframe id="ytPlayer" allowfullscreen></iframe>
    </div>
</section>

</div>

<script>
/* PAGE NAVIGATION */
document.querySelectorAll(".nav-link").forEach(link => {
    link.onclick = () => {
        document.querySelectorAll(".nav-link").forEach(l => l.classList.remove("active"));
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        link.classList.add("active");
        document.getElementById(link.dataset.page).classList.add("active");
    };
});

/* LOAD PLAYLISTS */
let playlists = JSON.parse(localStorage.getItem("wavetune")) || {
    "Chill Vibes": [], "Workout Mix": [], "Road Trip": []
};

function save() { localStorage.setItem("wavetune", JSON.stringify(playlists)); }

/* UPDATE SELECT */
function updateSelect() {
    const sel = document.getElementById("playlistSelect");
    sel.innerHTML = "";
    Object.keys(playlists).forEach(p => sel.innerHTML += `<option>${p}</option>`);
}
updateSelect();

/* ADD SONG */
document.getElementById("addSongBtn").onclick = () => {
    const link = document.getElementById("ytLink").value.trim();
    const playlistName = document.getElementById("playlistSelect").value;
    if (!isValidYouTubeLink(link)) return alert("Please enter a valid YouTube link");

    const videoId = getYouTubeID(link);
    if (!videoId) return alert("Unable to read YouTube video ID");

    playlists[playlistName].push({
        title: "YouTube Song " + (playlists[playlistName].length + 1),
        artist: "YouTube", link: link, videoId: videoId
    });

    save();
    document.getElementById("ytLink").value = "";
    renderPlaylist(playlistName);
};

/* RENDER PLAYLIST */
function renderPlaylist(name) {
    currentPlaylistTitle.textContent = name;
    playlistSongs.innerHTML = "";
    playlists[name].forEach((song, i) => {
        if (!song.title.toLowerCase().includes(searchSong.value.toLowerCase())) return;
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between";
        li.innerHTML = `<span style="cursor:pointer">${song.title}</span>
                        <button class="btn btn-danger btn-sm">X</button>`;
        li.querySelector("span").onclick = () => playSong(song);
        li.querySelector("button").onclick = () => {
            playlists[name].splice(i,1); save(); renderPlaylist(name);
        };
        playlistSongs.appendChild(li);
    });
}

/* PLAY SONG */
function playSong(song) {
    document.querySelector(".song-title").textContent = song.title;
    document.querySelector(".song-artist").textContent = song.artist;
    document.getElementById("songThumbnail").src = "https://img.youtube.com/vi/" + song.videoId + "/hqdefault.jpg";
    document.getElementById("ytPlayer").src = "https://www.youtube.com/embed/" + song.videoId + "?autoplay=1";
    document.querySelector('[data-page="nowplaying"]').click();
}

/* PLAYLIST CARDS */
document.querySelectorAll(".playlist-card").forEach(card => {
    card.onclick = () => { renderPlaylist(card.dataset.playlist); document.querySelector('[data-page="playlist"]').click(); };
});

/* SEARCH SONGS */
searchSong.oninput = () => renderPlaylist(currentPlaylistTitle.textContent);

/* CREATE / RENAME / DELETE PLAYLIST */
function createPlaylist() {
    const n = prompt("Playlist name?");
    if (!n || playlists[n]) return;
    playlists[n]=[]; save(); updateSelect();
}
function renamePlaylist() {
    const old=currentPlaylistTitle.textContent; const n=prompt("New name?");
    if(!n||playlists[n])return;
    playlists[n]=playlists[old]; delete playlists[old]; save(); updateSelect(); renderPlaylist(n);
}
function deletePlaylist() {
    const n=currentPlaylistTitle.textContent;
    if(!confirm("Delete playlist?"))return;
    delete playlists[n]; save(); playlistSongs.innerHTML="";
}

/* YOUTUBE VALIDATION / ID */
function isValidYouTubeLink(url){ return /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(url);}
function getYouTubeID(url){
    if(url.includes("youtu.be/")) return url.split("youtu.be/")[1].split("?")[0];
    if(url.includes("watch?v=")) return url.split("watch?v=")[1].split("&")[0];
    return null;
}
</script>

</body>
</html>
